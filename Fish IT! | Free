loadstring(game:HttpGet("https://raw.githubusercontent.com/xwvufdwgqudwyfwdvwedyuvwd/gbewufbeufbeugfvr/refs/heads/main/update%20eifuheuehf"))()
loadstring(game:HttpGet("https://raw.githubusercontent.com/fewnbhefbevfhevfdfveh/ckhsuciceifgeufhefveyfg/refs/heads/main/Webhook%20Fish%20Gui%20dywfywgfwyfvwydgvy"))()
loadstring(game:HttpGet("https://raw.githubusercontent.com/xwvufdwgqudwyfwdvwedyuvwd/gbewufbeufbeugfvr/refs/heads/main/Semua"))()
local MacLib = loadstring(game:HttpGet("https://github.com/biggaboy212/Maclib/releases/latest/download/maclib.txt"))()

-- Deklarasi service dan variabel utama (tidak diubah) jangan di ubah ubah sama sekali
local workspace = workspace
local Players = game:GetService("Players")
local player = Players.LocalPlayer
local character = player.Character or player.CharacterAdded:Wait()
local hrp = character:WaitForChild("HumanoidRootPart")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local RunService = game:GetService("RunService")
local LocalPlayer = player -- alias supaya sama dengan LocalPlayer

local camera = workspace.CurrentCamera
local screenSize = camera.ViewportSize

local Window = MacLib:Window({
    Title = "Nexa | Freemium",
    Subtitle = "Fish It | V0.0.1",
    Size = UDim2.fromOffset(720, 410),
    DragStyle = 1,
    DisabledWindowControls = {},
    ShowUserInfo = false,
    Keybind = Enum.KeyCode.G,
    AcrylicBlur = true,
})

local cg = game:GetService("CoreGui")

task.spawn(function()
    while true do
        for _, obj in ipairs(cg:GetDescendants()) do
            if obj.Name == "UserInfo" then
                obj:Destroy()
            end
        end
        task.wait(1)
    end
end)

if not player then
    Players:GetPropertyChangedSignal("LocalPlayer"):Wait()
    player = Players.LocalPlayer
end

if not Window or type(Window.Notify) ~= "function" then
    warn("Window:Notify tidak ditemukan. Pastikan Window tersedia sebelum menjalankan script.")
    return
end

local counterFile = "3" .. tostring(player.UserId) .. ".txt"
local executeCount = 0

if type(isfile) == "function" and type(readfile) == "function" then
    local ok, content = pcall(function()
        return isfile(counterFile) and readfile(counterFile) or nil
    end)
    if ok and content then
        executeCount = tonumber(content) or 0
    else
        executeCount = 0
    end
end

executeCount = executeCount + 1

if type(writefile) == "function" then
    pcall(function()
        writefile(counterFile, tostring(executeCount))
    end)
end

local function safeNotify(tbl)
    pcall(function()
        Window:Notify(tbl)
    end)
end

coroutine.wrap(function()
    safeNotify({
        Title = "Welcome",
        Description = "Welcome! Thank you for using the Nexa script.",
        Lifetime = 2,
    })
    task.wait(2)

    local displayName = tostring(player.DisplayName or player.Name or "Player")
    safeNotify({
        Title = "Nexa",
        Description = "Player: " .. displayName .. "\nScript executed " .. tostring(executeCount) .. " time(s).",
        Lifetime = 2,
    })
    task.wait(2)

    safeNotify({
        Title = "Bug Report",
        Description = "If there are any errors, please report them to the developer. Join Discord to report bugs.",
        Lifetime = 2,
    })
    task.wait(2)

    safeNotify({
        Title = "Purchase",
        Description = "If you want to buy a premium script key, join Discord to purchase.",
        Lifetime = 2,
    })
    task.wait(2)

    safeNotify({
        Title = "Thanks",
        Description = "Thank you for using Nexa! Enjoy its features.",
        Lifetime = 2,
    })
end)()

local tabGroups = {
	TabGroup1 = Window:TabGroup()
}

local tabs = {
	Fishing = tabGroups.TabGroup1:Tab({ Name = "Fishing", Image = "rbxassetid://97899956724998" }),
	Quest = tabGroups.TabGroup1:Tab({ Name = "Quest", Image = "rbxassetid://70719631016787" }),
    Auto = tabGroups.TabGroup1:Tab({ Name = "Automatic", Image = "rbxassetid://100691400534443" }),
	Shop = tabGroups.TabGroup1:Tab({ Name = "Shop", Image = "rbxassetid://134257769519180" }),
	Boat = tabGroups.TabGroup1:Tab({ Name = "Boat", Image = "rbxassetid://79620448065359" }),
    Tp = tabGroups.TabGroup1:Tab({ Name = "Teleport", Image = "rbxassetid://124499210049583" }),
	Player = tabGroups.TabGroup1:Tab({ Name = "Player", Image = "rbxassetid://105274848905298" }),
	Config = tabGroups.TabGroup1:Tab({ Name = "Config", Image = "rbxassetid://111411260968321" }),
}
local sections = {
	Fishing = tabs.Fishing:Section({ Side = "Left" }),
    Fishing1 = tabs.Fishing:Section({ Side = "Right" }),
    Quest = tabs.Quest:Section({ Side = "Left" }),
    Quest1 = tabs.Quest:Section({ Side = "Right" }),
    Auto = tabs.Auto:Section({ Side = "Left" }),
    Auto1 = tabs.Auto:Section({ Side = "Right" }),
    Shop = tabs.Shop:Section({ Side = "Left" }),
    Shop1 = tabs.Shop:Section({ Side = "Right" }),
    Boat = tabs.Boat:Section({ Side = "Left" }),
    Boat1 = tabs.Boat:Section({ Side = "Right" }),
    Tp = tabs.Tp:Section({ Side = "Left" }),
    Tp1 = tabs.Tp:Section({ Side = "Right" }),
    Player = tabs.Player:Section({ Side = "Left" }),
}

sections.Fishing:Header({
	Name = "Fishing Feature"
})

local FishingController = require(ReplicatedStorage.Controllers.FishingController)
local AutoFishingController = require(ReplicatedStorage.Controllers.AutoFishingController)
local Replion = require(ReplicatedStorage.Packages.Replion)

-- STATE
local AutoFishState = {
	IsActive = false,
	MinigameActive = false
}

local ClickSpeed = 0.05

-- CLICK FUNCTION
local function performClick()
	FishingController:RequestFishingMinigameClick()
	task.wait(ClickSpeed + math.random() * ClickSpeed)
end

-- FORCE AUTOFISH ALWAYS ON
local originalAutoFishingStateChanged = AutoFishingController.AutoFishingStateChanged
AutoFishingController.AutoFishingStateChanged = function(...)
	return originalAutoFishingStateChanged(true)
end

-- FORCE SERVER AUTO FISHING ON
local function ensureServerAutoFishingOn()
	local replionData = Replion.Client:WaitReplion("Data")
	local currentAutoFishingState = replionData:GetExpect("AutoFishing")

	if not currentAutoFishingState then
		local Net = require(ReplicatedStorage.Packages.Net)
		local UpdateAutoFishingRemote = Net:RemoteFunction("UpdateAutoFishingState")

		pcall(function()
			UpdateAutoFishingRemote:InvokeServer(true)
		end)
	end
end

-- HOOK MINIGAME
local originalRodStarted = FishingController.FishingRodStarted
local originalFishingStopped = FishingController.FishingStopped

local clickThread = nil

FishingController.FishingRodStarted = function(self, ...)
	originalRodStarted(self, ...)

	if AutoFishState.IsActive and not AutoFishState.MinigameActive then
		AutoFishState.MinigameActive = true

		if clickThread then task.cancel(clickThread) end

		clickThread = task.spawn(function()
			while AutoFishState.IsActive and AutoFishState.MinigameActive do
				performClick()
			end
		end)
	end
end

FishingController.FishingStopped = function(self, ...)
	originalFishingStopped(self, ...)

	if AutoFishState.MinigameActive then
		AutoFishState.MinigameActive = false
		task.wait(1)
		ensureServerAutoFishingOn()
	end
end

-- TOGGLE
local function ToggleAutoClick(shouldActivate)
	AutoFishState.IsActive = shouldActivate

	if shouldActivate then
		ensureServerAutoFishingOn()
	else
		if clickThread then
			task.cancel(clickThread)
			clickThread = nil
		end

		AutoFishState.MinigameActive = false
	end
end

-- =====================================================================
--  UI (FORMAT BARU)
-- =====================================================================

sections.Fishing:Toggle({
	Name = "Auto Fish Legit",
	Default = false,
	Callback = function(value)
		ToggleAutoClick(value)

		Window:Notify({
			Title = "Auto Fish Legit",
			Description = (value and "Enabled " or "Disabled ") .. "Auto Fish"
		})
	end,
}, "AutoFishToggle")

sections.Fishing:Input({
	Name = "Click Speed",
	Placeholder = "Default: 0.05",
	AcceptedCharacters = "Numbers",
	Callback = function(value)
		local num = tonumber(value)

		if num and num > 0 then
			ClickSpeed = num
			Window:Notify({
				Title = "Speed",
				Description = "Click Speed set to: " .. num
			})
		end
	end,
}, "AutoFishSpeed")

sections.Fishing:Toggle({
	Name = "Show Fishing Counter Gui",
	Default = false,
	Callback = function(state)
		local fishingCounterGui = player.PlayerGui:FindFirstChild("FishingCounterGui")

		if fishingCounterGui then
			fishingCounterGui.Enabled = state
		else
			warn("FishingCounterGui not found!")
		end
	end,
}, "ShowFishingCounterGuiToggle")

local stopAnimConnections = {}

local function setGameAnimationsEnabled(state)
    local character = player.Character or player.CharacterAdded:Wait()
    local humanoid = character:FindFirstChildOfClass("Humanoid")
    if not humanoid then
        return
    end

    -- Bersihkan koneksi animasi lama
    for _, conn in ipairs(stopAnimConnections) do
        conn:Disconnect()
    end
    stopAnimConnections = {}

    if state then
        -- Hentikan semua animasi yg sedang berjalan
        local animator = humanoid:FindFirstChildOfClass("Animator")
        if animator then
            for _, track in ipairs(animator:GetPlayingAnimationTracks()) do
                track:Stop(0)
            end

            -- Cegah animasi baru dimainkan
            local conn = animator.AnimationPlayed:Connect(function(track)
                task.defer(function()
                    track:Stop(0)
                end)
            end)
            table.insert(stopAnimConnections, conn)
        end
    else
        -- Re-enable: cukup matikan koneksi
        for _, conn in ipairs(stopAnimConnections) do
            conn:Disconnect()
        end
        stopAnimConnections = {}
    end

    -- Notify WindUI
    Window:Notify({
        Title = "No Animation",
        Description = (state and "Enabled " or "Disabled ") .. "No Animation"
    })
end

-- =====================================================================
-- Toggle WindUI (Format Baru)
-- =====================================================================

sections.Fishing:Toggle({
    Name = "No Animation",
    Default = false,
    Callback = function(state)
        setGameAnimationsEnabled(state)
    end,
})

local autoEnabled = false       -- toggle state
local remoteDelay = 1           -- default delay

-- ======================================================
-- UI INPUT (SET DELAY)
-- ======================================================
sections.Fishing:Input({ 
	Name = "Delay Reel",
	Placeholder = "Default: 1", 
	AcceptedCharacters = "All",
	Callback = function(input)
		local num = tonumber(input)
		if num then
			remoteDelay = num
			print("Delay set to:", remoteDelay)
		else
			print("Invalid Input")
		end
	end,
}, "DelayReelInput")

-- ======================================================
-- UI TOGGLE (ENABLE / DISABLE AUTO)
-- ======================================================
sections.Fishing:Toggle({ 
	Name = "Instant Reel",
	Default = false,
	Callback = function(state)
		autoEnabled = state

		Window:Notify({
			Title = "Instant Reel",
			Description = state and "Auto Fishing Enabled" or "Auto Fishing Disabled"
		})
	end,
}, "InstantReelToggle")

-- ======================================================
-- REMOTE REFERENCES
-- ======================================================
local REReplicateTextEffect = ReplicatedStorage
	:WaitForChild("Packages")
	:WaitForChild("_Index")
	:WaitForChild("sleitnick_net@0.2.0")
	:WaitForChild("net")
	:WaitForChild("RE/ReplicateTextEffect")

local REFishingCompleted = ReplicatedStorage
	:WaitForChild("Packages")
	:WaitForChild("_Index")
	:WaitForChild("sleitnick_net@0.2.0")
	:WaitForChild("net")
	:WaitForChild("RE/FishingCompleted")

local Character = LocalPlayer.Character or LocalPlayer.CharacterAdded:Wait()

-- ======================================================
-- LISTENER AUTO FISHING
-- ======================================================
REReplicateTextEffect.OnClientEvent:Connect(function(data)
	if not autoEnabled then return end
	if not data or not data.TextData then return end

	local attach = data.TextData.AttachTo
	if not attach or not attach.Parent then return end

	local character = attach.Parent
	local player = Players:GetPlayerFromCharacter(character)

	-- hanya trigger bila effect milik LocalPlayer
	if player ~= LocalPlayer then return end

	-- delay sesuai input user
	task.delay(remoteDelay, function()
		if autoEnabled then
			REFishingCompleted:FireServer()
		end
	end)
end)

-- Ambil RemoteFunction CancelFishing
local CancelFishing = ReplicatedStorage
    :WaitForChild("Packages")
    :WaitForChild("_Index")
    :WaitForChild("sleitnick_net@0.2.0")
    :WaitForChild("net")
    :WaitForChild("RF/CancelFishingInputs")

-- Button Baru Format sections.Fishing
sections.Fishing:Button({
	Name = "Cancel Fishing",
	Callback = function()
		CancelFishing:InvokeServer()
	end,
})


sections.Fishing:Header({
	Name = "Instant Fishing Feature"
})

-- ========================================================================
-- REMOTES
-- ========================================================================
local package = ReplicatedStorage.Packages._Index["sleitnick_net@0.2.0"].net

local ChargeFishingRod = package["RF/ChargeFishingRod"]
local RequestFishingMinigameStarted = package["RF/RequestFishingMinigameStarted"]
local REReplicateTextEffect = package["RE/ReplicateTextEffect"]
local REFishingCompleted = package["RE/FishingCompleted"]
local CancelFishingInputs = package["RF/CancelFishingInputs"]

-- ========================================================================
-- PARAMETER & STATE
-- ========================================================================
local miniggameArgs = {
    -1.233184814453125,
    0.9972056628181873,
    1763291794.158201
}

local isFishing = false
local autoFishingEnabled = false
local antiStuckEnabled = false

local castDelay = 1.5
local completedDelay = 1

-- ========================================================================
-- SAFE WAIT
-- ========================================================================
local function SafeWait(t)
    local start = os.clock()
    while os.clock() - start < t do
        if not autoFishingEnabled then return false end
        task.wait()
    end
    return true
end

-- ========================================================================
-- MAIN FISHING CYCLE
-- ========================================================================
local function StartFishingCycle()
    if not autoFishingEnabled then return end
    if isFishing then return end

    isFishing = true

    ChargeFishingRod:InvokeServer()
    if not SafeWait(0.2) then return end

    RequestFishingMinigameStarted:InvokeServer(unpack(miniggameArgs))
end

-- ========================================================================
-- DETECT MINIGAME COMPLETED
-- ========================================================================
REReplicateTextEffect.OnClientEvent:Connect(function(data)
    if not autoFishingEnabled then return end
    if not data or not data.TextData then return end

    local attach = data.TextData.AttachTo
    if not attach or not attach.Parent then return end

    local character = attach.Parent
    local player = Players:GetPlayerFromCharacter(character)
    if player ~= LocalPlayer then return end

    task.spawn(function()
        if not SafeWait(completedDelay) then return end
        REFishingCompleted:FireServer()
        isFishing = false

        if not SafeWait(castDelay) then return end
        StartFishingCycle()
    end)
end)

-- ========================================================================
-- ANTI STUCK DETECTOR (UI Freeze 10 Detik)
-- ========================================================================

task.spawn(function()
    local notifGui
    local notifFrame

    repeat
        task.wait(1)
        notifGui = LocalPlayer:WaitForChild("PlayerGui"):FindFirstChild("Small Notification")
    until notifGui

    notifFrame = notifGui:WaitForChild("Display"):WaitForChild("Container")

    while true do
        task.wait(1)

        if antiStuckEnabled and autoFishingEnabled then
            local lastPos = notifFrame.Position
            local freezeDetected = true

            for i = 1, 10 do
                task.wait(1)
                if not antiStuckEnabled or not autoFishingEnabled then break end

                if notifFrame.Position ~= lastPos then
                    freezeDetected = false
                    break
                end
            end

            if freezeDetected and antiStuckEnabled and autoFishingEnabled then
                warn("[InstantFishing] Anti Stuck Triggered â†’ Cancel Fishing & Restart")

                pcall(function()
                    CancelFishingInputs:InvokeServer()
                end)

                isFishing = false

                task.wait(0.5)
                if autoFishingEnabled then
                    StartFishingCycle()
                end
            end
        end
    end
end)

-- ========================================================================
-- WINDUI: Instant Fishing
-- ========================================================================

sections.Fishing:Toggle({
	Name = "Instant Fishing",
	Default = false,
	Callback = function(state)
		autoFishingEnabled = state

        if state then
            StartFishingCycle()
        else
            isFishing = false
        end

		Window:Notify({
			Title = "Instant Fishing",
			Description = (state and "Enabled" or "Disabled") .. " Instant Fishing"
		})
	end,
}, "InstantFishingToggle")

-- ========================================================================
-- WINDUI: ANTI STUCK DETECTOR
-- ========================================================================
sections.Fishing:Toggle({
	Name = "Anti Stuck Detector",
	Default = false,
	Callback = function(state)
		antiStuckEnabled = state

		Window:Notify({
			Title = "Anti Stuck Detector",
			Description = (state and "Enabled" or "Disabled") .. " Anti Stuck System"
		})
	end,
}, "AntiStuckDetectorToggle")

sections.Fishing:Input({
	Name = "Cast Delay",
	Placeholder = "Default: 1.5",
	AcceptedCharacters = "Numbers",
	Callback = function(input)
		castDelay = tonumber(input) or 1.5
		Window:Notify({
			Title = "Cast Delay",
			Description = "Cast Delay set to: " .. tostring(castDelay)
		})
	end,
}, "InstantFishingCastDelay")

sections.Fishing:Input({
	Name = "Completed Delay",
	Placeholder = "Default: 1",
	AcceptedCharacters = "Numbers",
	Callback = function(input)
		completedDelay = tonumber(input) or 1
		Window:Notify({
			Title = "Completed Delay",
			Description = "Completed Delay set to: " .. tostring(completedDelay)
		})
	end,
}, "InstantFishingCompletedDelay")

sections.Fishing1:Header({
	Name = "Equipment Feature"
})

-- Module
local Net = require(ReplicatedStorage.Packages.Net)
local Replion = require(ReplicatedStorage.Packages.Replion).Client

-- RemoteEvent EquipItem
local EquipItemEvent = Net:RemoteEvent("EquipItem")

-- Data player
local data = Replion:WaitReplion("Data")

-- Variabel untuk menyimpan nama rod yang dipilih
local SelectedRodName = "Starter Rod"

-- Dropdown baru (format sections)
sections.Fishing1:Dropdown({
	Name = "Select Rod",
	Search = true,
	Multi = false,
	Options = {
		"Starter Rod",
		"Luck Rod",
		"Carbon Rod",
		"Grass Rod",
		"Demascus Rod",
		"Ice Rod",
		"Lucky Rod",
		"Midnight Rod",
		"Steampunk Rod",
		"Chrome Rod",
		"Fluorescent Rod",
		"Astral Rod",
		"Angler Rod",
		"Ares Rod",
		"Bamboo Rod",
		"Toy Rod",
		"Lava Rod",
		"Hazmat Rod",
		"Ghostfinn Rod",
		"Element Rod",
		"Angelic Rod",
		"Gold Rod",
		"Hyper Rod"
	},
	Default = "Starter Rod",
	Callback = function(Value)
		SelectedRodName = Value
	end,
}, "RodDropdown")


-- Button baru (format sections)
sections.Fishing1:Button({
	Name = "Equip Selected Rod",
	Callback = function()

		local RodIDs = {
			["Starter Rod"] = 1,
			["Luck Rod"] = 79,
			["Carbon Rod"] = 76,
			["Grass Rod"] = 85,
			["Demascus Rod"] = 77,
			["Ice Rod"] = 78,
			["Lucky Rod"] = 4,
			["Midnight Rod"] = 80,
			["Steampunk Rod"] = 6,
			["Chrome Rod"] = 7,
			["Fluorescent Rod"] = 255,
			["Astral Rod"] = 5,
			["Angler Rod"] = 168,
			["Ares Rod"] = 126,
			["Bamboo Rod"] = 258,
			["Toy Rod"] = 84,
			["Lava Rod"] = 2,
			["Hazmat Rod"] = 256,
			["Ghostfinn Rod"] = 169,
			["Element Rod"] = 257,
			["Angelic Rod"] = 124,
			["Gold Rod"] = 8,
			["Hyper Rod"] = 9
		}

		local selectedID = RodIDs[SelectedRodName]
		if not selectedID then return end

		local rods = data:GetExpect({"Inventory", "Fishing Rods"})
		if not rods then return end

		for _, rod in ipairs(rods) do
			if rod and rod.Id == selectedID then
				EquipItemEvent:FireServer(rod.UUID, "Fishing Rods")
				break
			end
		end
	end,
})

-- RemoteEvent EquipBait
local equipBaitRemote = ReplicatedStorage
    :WaitForChild("Packages")
    :WaitForChild("_Index")
    :WaitForChild("sleitnick_net@0.2.0")
    :WaitForChild("net")
    :WaitForChild("RE/EquipBait")

local selectedID = nil

-- Dropdown pilih Bait (UI Baru)
sections.Fishing1:Dropdown({
    Name = "Select Bait",
    Options = {
        "Starter Bait",
        "Topwater Bait",
        "Luck Bait",
        "Midnight Bait",
        "Nature Bait",
        "Chroma Bait",
        "Royal Bait",
        "Dark Matter Bait",
        "Corrupt Bait",
        "Aether Bait",
        "Floral Bait",
        "Singularity Bait",
        "Beach Ball Bait",
        "Gold Bait",
        "Hyper Bait"
    },
    Default = "Starter Bait",
    Search = true,

    Callback = function(selected)
        local BobberIDs = {
            ["Starter Bait"] = 1,
            ["Luck Bait"] = 2,
            ["Gold Bait"] = 4,
            ["Hyper Bait"] = 5,
            ["Chroma Bait"] = 6,
            ["Dark Matter Bait"] = 8,
            ["Beach Ball Bait"] = 9,
            ["Topwater Bait"] = 10,
            ["Corrupt Bait"] = 15,
            ["Aether Bait"] = 16,
            ["Nature Bait"] = 17,
            ["Singularity Bait"] = 18,
            ["Royal Bait"] = 19,
            ["Floral Bait"] = 20,
        }

        selectedID = BobberIDs[selected]
    end,
})

-- Tombol Equip Bait (UI Baru)
sections.Fishing1:Button({
	Name = "Equip Selected Bait",
	Callback = function()
		if selectedID then
			equipBaitRemote:FireServer(selectedID)
		end
	end,
})

-- Ambil RemoteEvent untuk equip rod
local netEvent = ReplicatedStorage:WaitForChild("Packages")
    :WaitForChild("_Index")
    :WaitForChild("sleitnick_net@0.2.0")
    :WaitForChild("net")
    :WaitForChild("RE/EquipToolFromHotbar")

local args = {1}

local autoEquipRod = false

-- Toggle Baru
sections.Fishing1:Toggle({
    Name = "Auto Equip Rod",
    Default = false,
    Callback = function(state)
        autoEquipRod = state
    end,
})

-- Loop Auto Equip
task.spawn(function()
    while true do
        if autoEquipRod then
            netEvent:FireServer(unpack(args))
        end
        task.wait(1)
    end
end)


sections.Fishing1:Header({
	Name = "Sell Feature"
})

local LocalPlayer = Players.LocalPlayer
local sellRemote = ReplicatedStorage:WaitForChild("Packages")
    :WaitForChild("_Index")
    :WaitForChild("sleitnick_net@0.2.0")
    :WaitForChild("net")
    :WaitForChild("RF/SellAllItems")

local autoSell = false
local sellDelay = 2
local mode = "Sell Delay"
local autoSellLoop = nil

-- Slider delay jual otomatis
sections.Fishing1:Slider({
	Name = "Sell Delay (seconds)",
	Default = 2,
	Minimum = 1,
	Maximum = 100,
	Rounding = 0,
	DisplayMethod = nil, -- atau bisa dihapus kalau tidak perlu
	Callback = function(value)
		sellDelay = value
	end,
}, "SellDelaySlider")

-- Dropdown mode auto sell
sections.Fishing1:Dropdown({
	Name = "Select Mode",
	Options = { "Backpack Full", "Sell Delay" },
	Default = "Sell Delay",
	Multi = false,
	Search = false,
	MaxVisibleDropdownItems = 5,
	Callback = function(option)
		mode = option
	end,
}, "SellModeDropdown")

-- Toggle auto sell
sections.Fishing1:Toggle({
	Name = "Auto Sell All Items",
	Default = false,
	Callback = function(state)
		autoSell = state

		if state then
			autoSellLoop = task.spawn(function()
				while autoSell do
					pcall(function()
						if mode == "Sell Delay" then
							sellRemote:InvokeServer()
							task.wait(sellDelay)
						elseif mode == "Backpack Full" then
							local bagLabel = LocalPlayer
								.PlayerGui
								.Inventory
								.Main
								.Top
								.Options
								.Fish
								.Label
								.BagSize

							if bagLabel and bagLabel.Text == "4,500/4,500" then
								sellRemote:InvokeServer()
							end
							task.wait(1)
						end
					end)
				end
			end)
		else
			if autoSellLoop then
				task.cancel(autoSellLoop)
				autoSellLoop = nil
			end
		end
	end,
}, "AutoSellToggle")

sections.Quest:Header({
	Name = "View Quest Status"
})

-- === DEEP SEA QUEST (UI baru dengan Section:Paragraph) ===
local board = workspace["!!! MENU RINGS"]["Deep Sea Tracker"].Board
local surfaceGui = board:WaitForChild("Gui")
local content = surfaceGui:WaitForChild("Content")
local labelNames = {"Label1", "Label2", "Label3", "Label4"}

local deepSeaParagraph = nil

-- Buat paragraph satu kali
deepSeaParagraph = sections.Quest:Paragraph({
    Header = "Deep Sea Status",
    Body = "Loading..."
})

local function updateDeepSea()
    local lines = {}

    for _, name in ipairs(labelNames) do
        local label = content:FindFirstChild(name)
        if label then
            table.insert(lines, label.Text)
        end
    end

    local newBody = table.concat(lines, "\n")

    -- INI YANG BENAR (sesuai hasil debug)
    if deepSeaParagraph and deepSeaParagraph.UpdateBody then
        deepSeaParagraph:UpdateBody(newBody)
    end
end

-- Update awal
updateDeepSea()

-- Listener setiap Label berubah
for _, name in ipairs(labelNames) do
    local label = content:FindFirstChild(name)
    if label then
        label:GetPropertyChangedSignal("Text"):Connect(updateDeepSea)
    end
end

-- === AURA BOAT QUEST (UI Baru Dengan Paragraph) ===
local auraParagraph = sections.Quest:Paragraph({
    Header = "Aura Boat Status",
    Body = "Loading..."
})

local function updateAura()
    local contentAura = workspace["!!! MENU RINGS"]["Aura Tracker"].Board.Gui.Content
    
    local combinedText = table.concat({
        contentAura.Label1.Text,
        contentAura.Label2.Text,
        contentAura.Label3.Text
    }, "\n")

    -- Update body pakai metode baru
    if auraParagraph and auraParagraph.UpdateBody then
        auraParagraph:UpdateBody(combinedText)
    end
end

task.spawn(function()
    while task.wait(1) do
        updateAura()
    end
end)

-- === ELEMENT QUEST (UI Baru Dengan Paragraph) ===
local boardElement = workspace["!!! MENU RINGS"]["Element Tracker"].Board
local surfaceGuiElement = boardElement:WaitForChild("Gui")
local contentElement = surfaceGuiElement:WaitForChild("Content")
local elementLabelNames = {"Label1", "Label2", "Label3", "Label4"}

-- Buat paragraph baru
local elementParagraph = sections.Quest:Paragraph({
    Header = "Element Status",
    Body = "Loading..."
})

local function updateElement()
    local lines = {}

    for _, name in ipairs(elementLabelNames) do
        local label = contentElement:FindFirstChild(name)
        if label then
            table.insert(lines, label.Text)
        end
    end

    local newBody = table.concat(lines, "\n")

    if elementParagraph and elementParagraph.UpdateBody then
        elementParagraph:UpdateBody(newBody)
    end
end

-- Update awal
updateElement()

-- Listener perubahan label
for _, name in ipairs(elementLabelNames) do
    local label = contentElement:FindFirstChild(name)
    if label then
        label:GetPropertyChangedSignal("Text"):Connect(updateElement)
    end
end

-- === TEMPLE LEVER STATUS (UI Baru Dengan Paragraph) ===
local Jungle = workspace:WaitForChild("JUNGLE INTERACTIONS")

local Steps = {
    "TempleLever 1",
    "TempleLever 2",
    "TempleLever 3",
    "TempleLever 4",
}

-- Buat paragraph UI baru
local templeLeverParagraph = sections.Quest:Paragraph({
    Header = "Temple Lever Status",
    Body = "Checking..."
})

local function updateStatus()
    local lines = {}

    for _, name in ipairs(Steps) do
        local lever = Jungle:FindFirstChild(name)
        local mark = "0%"

        if lever and lever:FindFirstChild("RootPart") then
            local root = lever.RootPart
            -- Jika ProximityPrompt hilang = lever sudah dipencet
            if not root:FindFirstChild("ProximityPrompt") then
                mark = "100%"
            end
        end

        table.insert(lines, string.format("%s: %s", name, mark))
    end

    local result = table.concat(lines, "\n")

    if templeLeverParagraph and templeLeverParagraph.UpdateBody then
        templeLeverParagraph:UpdateBody(result)
    end
end

task.spawn(function()
    while task.wait(1) do
        pcall(updateStatus)
    end
end)

sections.Quest1:Header({
	Name = "Auto Quest"
})

local RunService = game:GetService("RunService")
local LocalPlayer = Players.LocalPlayer

-- Konfigurasi Quest
local Quests = {
    ["Deep Sea"] = {
        Label = workspace["!!! MENU RINGS"]["Deep Sea Tracker"].Board.Gui.Content:WaitForChild("Label1"),
        PosBelum100 = CFrame.new(-3598.26392, -275.770294, -1641.81677, 0.980732918, 1.77961817e-08, -0.195353389, -9.95774929e-09, 1, 1.49543828e-08, 0.195353389, -3.92007387e-08, 0.980732918),
        PosSudah100 = CFrame.new(-3711.07275, -133.551468, -946.792786, 0.496201038, 3.27622705e-08, 0.868207633, -1.09039476e-07, 1, 1.24582756e-08, -0.868207633, -1.06866807e-07, 0.496201038)
    },
    ["Element"] = {
        Label = workspace["!!! MENU RINGS"]["Element Tracker"].Board.Gui.Content:WaitForChild("Label2"),
        PosBelum100 = CFrame.new(2117.75146, -91.1985855, -700.854065, 0.931628525, -2.26793677e-08, -0.363411963, -9.1509369e-09, 1, -8.58657501e-08, 0.363411963, 8.33205434e-08, 0.931628525),
        PosSudah100 = CFrame.new(1556.35583, 4.37500525, -605.774841, -0.154411227, 1.18263046e-07, 0.988006651, 6.54793553e-08, 1, -1.09465148e-07, -0.988006651, 4.77913886e-08, -0.154411227)
    },
    ["Aura Boat"] = {
        PosTarget = CFrame.new(88.2434769, 9.53157043, 2685.2605),
        MinLevel = 200
    },
    ["Temple Lever"] = {
        Steps = {
            { Name = "TempleLever 1", CFrame = CFrame.new(1837.76038, 6.46929169, -289.37793, 0.209234059, -5.19205168e-09, -0.977865577, -1.23823077e-10, 1, -5.33607025e-09, 0.977865577, 1.23757005e-09, 0.209234059) },
            { Name = "TempleLever 2", CFrame = CFrame.new(1407.78601, 6.59558344, 118.577896, -0.919609904, -9.32684685e-08, 0.392832845, -8.06826606e-08, 1, 4.85496443e-08, -0.392832845, 1.29519346e-08, -0.919609904) },
            { Name = "TempleLever 3", CFrame = CFrame.new(877.883911, 4.8866396, -358.809021, -0.169639081, 7.49071702e-08, 0.985506237, -4.26608402e-08, 1, -8.3352198e-08, -0.985506237, -5.61823157e-08, -0.169639081) },
            { Name = "TempleLever 4", CFrame = CFrame.new(1487.44971, 6.4896245, -847.88324, -0.996084929, -9.576409e-09, -0.0884061007, -1.68435523e-08, 1, 8.14600511e-08, 0.0884061007, 8.26301232e-08, -0.996084929) },
        }
    }
}

local selectedQuest = "Deep Sea"
local autoQuestEnabled = false
local freezeBV, freezeBG
local savedCFrame

local function Freeze(char, cf)
    local hrp = char:FindFirstChild("HumanoidRootPart")
    if not hrp then return end

    if freezeBV then freezeBV:Destroy() freezeBV = nil end
    if freezeBG then freezeBG:Destroy() freezeBG = nil end

    freezeBV = Instance.new("BodyVelocity")
    freezeBV.Velocity = Vector3.zero
    freezeBV.MaxForce = Vector3.new(9e9, 9e9, 9e9)
    freezeBV.Parent = hrp

    freezeBG = Instance.new("BodyGyro")
    freezeBG.MaxTorque = Vector3.new(9e9, 9e9, 9e9)
    freezeBG.CFrame = cf or hrp.CFrame
    freezeBG.Parent = hrp
end

local function Unfreeze()
    if freezeBV then freezeBV:Destroy() freezeBV = nil end
    if freezeBG then freezeBG:Destroy() freezeBG = nil end
end

local function TeleportOnce(cf)
    local char = LocalPlayer.Character
    if char and char:FindFirstChild("HumanoidRootPart") then
        char:SetPrimaryPartCFrame(cf)
        savedCFrame = cf
        Freeze(char, cf)
    end
end

local function RunTempleLever()
    task.spawn(function()
        local Jungle = workspace:WaitForChild("JUNGLE INTERACTIONS")
        local char = LocalPlayer.Character or LocalPlayer.CharacterAdded:Wait()
        local hrp = char:WaitForChild("HumanoidRootPart")
        local steps = Quests["Temple Lever"].Steps

        for _, step in ipairs(steps) do
            if not autoQuestEnabled or selectedQuest ~= "Temple Lever" then break end
            local lever = Jungle:FindFirstChild(step.Name)

            if lever and lever:FindFirstChild("RootPart") then
                hrp.CFrame = step.CFrame
                task.wait(0.5)
                local prompt = lever.RootPart:FindFirstChild("ProximityPrompt")
                if prompt then
                    fireproximityprompt(prompt)
                    task.wait(5)
                end
            end
            task.wait(1)
        end
    end)
end

local function CheckQuest()
    if not autoQuestEnabled or not selectedQuest then return end

    local char = LocalPlayer.Character or LocalPlayer.CharacterAdded:Wait()
    local hrp = char:WaitForChild("HumanoidRootPart")

    if selectedQuest == "Aura Boat" then
        local overhead = hrp:WaitForChild("Overhead")
        local levelLabel = overhead:WaitForChild("LevelContainer"):WaitForChild("Label")
        local level = tonumber(levelLabel.Text:match("%d+")) or 0
        if level >= Quests["Aura Boat"].MinLevel then
            TeleportOnce(Quests["Aura Boat"].PosTarget)
        end

    elseif selectedQuest == "Temple Lever" then
        RunTempleLever()

    else
        local quest = Quests[selectedQuest]
        local text = quest.Label.Text
        local persen = tonumber(text:match("(%d+)%%"))
        if persen and persen < 100 then
            TeleportOnce(quest.PosBelum100)
        else
            TeleportOnce(quest.PosSudah100)
        end
    end
end

for name, quest in pairs(Quests) do
    if quest.Label then
        quest.Label:GetPropertyChangedSignal("Text"):Connect(function()
            if selectedQuest == name and autoQuestEnabled then
                CheckQuest()
            end
        end)
    end
end

RunService.Heartbeat:Connect(function()
    if autoQuestEnabled and savedCFrame then
        local char = LocalPlayer.Character
        if char and char:FindFirstChild("HumanoidRootPart") then
            local hrp = char.HumanoidRootPart
            if (hrp.Position - savedCFrame.Position).Magnitude > 2 then
                hrp.CFrame = savedCFrame
            end
        end
    end
end)

-- UI Dropdown (baru)
sections.Quest1:Dropdown({
	Name = "Select Quest",
	Options = { "Deep Sea", "Element", "Aura Boat", "Temple Lever" },
	Default = "Deep Sea",
	Multi = false,
	Search = false,
	Callback = function(option)
		selectedQuest = option
		if autoQuestEnabled then
			CheckQuest()
		end
	end,
}, "QuestDropdown")

-- UI Toggle (baru)
sections.Quest1:Toggle({
	Name = "Auto Quest",
	Default = false,
	Callback = function(state)
		autoQuestEnabled = state
		if state then
			CheckQuest()
		else
			Unfreeze()
			savedCFrame = nil
		end
	end,
}, "AutoQuestToggle")

sections.Auto:Header({
	Name = "Auto Favorite & Trade"
})

local Net = require(ReplicatedStorage.Packages.Net)
local ReplionClient = require(ReplicatedStorage.Packages.Replion).Client
local DataReplion = ReplionClient:WaitReplion("Data")
local ItemUtility = require(ReplicatedStorage.Shared.ItemUtility)

-- Remotes
local FavoriteRemote = Net:RemoteEvent("FavoriteItem")

local TradeRemote = ReplicatedStorage
	:WaitForChild("Packages")
	:WaitForChild("_Index")
	:WaitForChild("sleitnick_net@0.2.0")
	:WaitForChild("net")
	:WaitForChild("RF/InitiateTrade")

local ItemsFolder = ReplicatedStorage:WaitForChild("Items")

-- ========================================================================
-- STATE
-- ========================================================================
local state = {
	selectedTiers = {},

	autoFavorite = false,
	autoUnfavorite = false,
	autoTrade = false,

	stopFavorite = false,
	stopUnfavorite = false,
	stopTrade = false,

	targetPlayer = "",

	fishTarget = 0,
	fishCount = 0,
}

-- ========================================================================
-- TIER LIST
-- ========================================================================
local TierList = { "Common","Uncommon","Rare","Epic","Legendary","Mythic","SECRET" }

local nameToTier = {
	Common = 1, Uncommon = 2, Rare = 3, Epic = 4,
	Legendary = 5, Mythic = 6, SECRET = 7
}

local function normalize(value)
	if not value then return {} end
	if type(value) == "string" then return { value } end

	local out = {}
	for k, v in pairs(value) do
		if type(k) == "string" and v == true then
			table.insert(out, k)
		elseif type(v) == "string" then
			table.insert(out, v)
		end
	end
	return out
end

local function isTierMatch(itemTier, selected)
	for _, tName in ipairs(selected) do
		if nameToTier[tName] == tonumber(itemTier) then
			return true
		end
	end
	return false
end

-- ========================================================================
-- SAFE CALL
-- ========================================================================
local function safeFavorite(uuid)
	pcall(function()
		FavoriteRemote:FireServer(uuid)
	end)
end

local function safeTrade(userid, uuid)
	pcall(function()
		TradeRemote:InvokeServer(userid, uuid)
	end)
end

-- ========================================================================
-- WORKER FAVORITE
-- ========================================================================
local function workerFavorite()
	local RATE = 0.06
	local LOOP_DELAY = 1.1

	while state.autoFavorite do
		if state.stopFavorite then return end

		local inventory = DataReplion:GetExpect("Inventory")
		if inventory and inventory.Items then
			for _, item in ipairs(inventory.Items) do
				if state.stopFavorite then return end

				local ok, data = pcall(function()
					return ItemUtility.GetItemDataFromItemType("Items", item.Id)
				end)

				if ok and data and data.Data then
					local tier = data.Data.Tier

					if isTierMatch(tier, state.selectedTiers) and not item.Favorited then
						safeFavorite(item.UUID)
						task.wait(RATE)
					end
				end
			end
		end

		task.wait(LOOP_DELAY)
	end
end

-- ========================================================================
-- WORKER UNFAVORITE
-- ========================================================================
local function workerUnfavorite()
	local RATE = 0.06
	local LOOP_DELAY = 1.1

	while state.autoUnfavorite do
		if state.stopUnfavorite then return end

		local inventory = DataReplion:GetExpect("Inventory")
		if inventory and inventory.Items then
			for _, item in ipairs(inventory.Items) do
				if state.stopUnfavorite then return end

				local ok, data = pcall(function()
					return ItemUtility.GetItemDataFromItemType("Items", item.Id)
				end)

				if ok and data and data.Data then
					local tier = data.Data.Tier

					if isTierMatch(tier, state.selectedTiers) and item.Favorited then
						safeFavorite(item.UUID)
						task.wait(RATE)
					end
				end
			end
		end

		task.wait(LOOP_DELAY)
	end
end

-- ========================================================================
-- WORKER TRADE
-- ========================================================================
local function workerTrade()
	local RATE = 0.15
	local LOOP_DELAY = 1.0

	while state.autoTrade do
		if state.stopTrade then return end

		local target = Players:FindFirstChild(state.targetPlayer)
		if not target then
			state.autoTrade = false
			return
		end

		local inventory = DataReplion:GetExpect({ "Inventory", "Items" }) or {}
		local list = {}

		for _, item in ipairs(inventory) do
			local ok, data = pcall(function()
				return ItemUtility.GetItemDataFromItemType("Items", item.Id)
			end)

			if ok and data and data.Data then
				if data.Data.Type == "Fish" and isTierMatch(data.Data.Tier, state.selectedTiers) then
					table.insert(list, item.UUID)
				end
			end
		end

		if #list == 0 then
			Window:Notify({
				Title = "Trade",
				Description = "No more fish for selected tier",
			})
			state.autoTrade = false
			break
		end

		for _, uuid in ipairs(list) do
			if not state.autoTrade then break end
			safeTrade(target.UserId, uuid)
			task.wait(RATE)
		end

		task.wait(LOOP_DELAY)
	end
end

-- ========================================================================
-- TRADE COMPLETED LISTENER + COUNT
-- ========================================================================
local notifGui = player.PlayerGui:WaitForChild("Text Notifications")
local notifFrame = notifGui:WaitForChild("Frame")

local function checkTradeTile(tile)
	local header = tile:FindFirstChild("Header")

	if header and header:IsA("TextLabel") then
		if header.Text == "Trade completed!" then

			state.fishCount = state.fishCount + 1

			Window:Notify({
				Title = "Trade",
				Description = "Trade completed! (" .. state.fishCount .. "/" .. state.fishTarget .. ")"
			})

			if state.fishTarget > 0 and state.fishCount >= state.fishTarget then
				state.autoTrade = false
				state.stopTrade = true

				Window:Notify({
					Title = "Trade",
					Description = "Trade target reached!"
				})
			end
		end
	end
end

for _, tile in ipairs(notifFrame:GetChildren()) do
	if tile.Name == "TextTile" then
		checkTradeTile(tile)
	end
end

notifFrame.ChildAdded:Connect(function(child)
	if child.Name == "TextTile" then
		local header = child:WaitForChild("Header", 5)
		if header then
			checkTradeTile(child)
		end
	end
end)

-- ========================================================================
-- UI SECTION
-- ========================================================================
sections.Auto:Input({
	Name = "Target Player",
	Placeholder = "Example: Nexa123",
	Callback = function(text)
		state.targetPlayer = text
	end
}, "PlayerInput")

sections.Auto:Input({
	Name = "Fish Amount Trade",
	Placeholder = "Example: 10",
	AcceptedCharacters = "0123456789",
	Callback = function(input)
		local amount = tonumber(input)
		if amount then
			state.fishTarget = amount
			state.fishCount = 0

			Window:Notify({
				Title = "Trade",
				Description = "Trade target set: ".. amount
			})
		else
			Window:Notify({
				Title = "Error",
				Description = "Input must be a number!"
			})
		end
	end,
}, "TargetAmountInput")

sections.Auto:Dropdown({
	Name = "Select Tier(s)",
	Search = true,
	Multi = true,
	Options = TierList,
	Default = {"Rare"},
	Callback = function(val)
		state.selectedTiers = normalize(val)

		Window:Notify({
			Title = "Tier Selected",
			Description = table.concat(state.selectedTiers, ", ")
		})
	end
}, "TierDropdown")

sections.Auto:Toggle({
	Name = "Auto Favorite",
	Default = false,
	Callback = function(b)
		state.autoFavorite = b
		state.stopFavorite = not b
		if b then task.spawn(workerFavorite) end
	end
}, "AutoFavoriteToggle")

sections.Auto:Toggle({
	Name = "Auto Unfavorite",
	Default = false,
	Callback = function(b)
		state.autoUnfavorite = b
		state.stopUnfavorite = not b
		if b then task.spawn(workerUnfavorite) end
	end
}, "AutoUnfavoriteToggle")

sections.Auto:Toggle({
	Name = "Auto Trade",
	Default = false,
	Callback = function(b)
		state.autoTrade = b
		state.stopTrade = not b
		if b then task.spawn(workerTrade) end
	end
}, "AutoTradeToggle")

sections.Auto1:Header({
	Name = "Auto Enchant"
})

-- === FIX TAMBAHAN WAJIB ===
local Options = { SelectedEnchants = {} }
local Toggles = { AutoEnchant = false }

-- Library utama
local Net = require(ReplicatedStorage.Packages.Net)
local Replion = require(ReplicatedStorage.Packages.Replion).Client

-- RemoteEvent
local EquipItemEvent = Net:RemoteEvent("EquipItem")
local EquipToolEvent = ReplicatedStorage:WaitForChild("Packages"):WaitForChild("_Index")
    :WaitForChild("sleitnick_net@0.2.0"):WaitForChild("net"):WaitForChild("RE/EquipToolFromHotbar")
local ActivateAltarEvent = ReplicatedStorage:WaitForChild("Packages"):WaitForChild("_Index")
    :WaitForChild("sleitnick_net@0.2.0"):WaitForChild("net"):WaitForChild("RE/ActivateEnchantingAltar")

-- === UI baru (Dropdown dan Toggle) ===
sections.Auto1:Dropdown({
    Name = "Select Enchant",
    Search = true,
    Multi = true,
    Required = false,
    Options = {
        "Leprechaun I",
        "Leprechaun II",
        "Mutation Hunter I",
        "Mutation Hunter II",
        "Gold Digger I",
        "Reeler I",
        "Big Hunter I",
        "Empowered I",
        "Glistening I",
        "Stargazer I",
        "Stormhunter I",
        "XPerienced I",
        "Cursed I",
        "Prismatic I"
    },
    Default = {"Leprechaun I"},
    Callback = function(Value)
        Options.SelectedEnchants = {}
        for enchantName, state in pairs(Value) do
            if state then
                Options.SelectedEnchants[enchantName] = true
            end
        end
    end,
}, "EnchantDropdown")

sections.Auto1:Toggle({
    Name = "Auto Enchant",
    Default = false,
    Callback = function(value)
        Toggles.AutoEnchant = value
        if value then
            if currentTask then task.cancel(currentTask) end
            currentTask = task.spawn(function()
                while Toggles.AutoEnchant do
                    local success = doEnchantCycle()
                    if success then
                        Toggles.AutoEnchant = false
                        break
                    else
                        task.wait(3)
                    end
                end
            end)
        else
            if currentTask then
                task.cancel(currentTask)
                currentTask = nil
            end
        end
    end,
}, "AutoEnchantToggle")

-- === Fungsi cek enchant yang dipilih ===
local function isTargetEnchant(text)
    local selected = Options.SelectedEnchants
    if typeof(selected) == "table" then
        for name, state in pairs(selected) do
            if state == true and string.find(text, name) then
                return true
            end
        end
    end
    return false
end

local currentTask

-- === Fungsi utama proses enchant ===
function doEnchantCycle()
    local data = Replion:WaitReplion("Data")
    local inventory = data:GetExpect("Inventory")
    local items = inventory and inventory["Items"]
    if not items then return false end

    local moduleTarget = ReplicatedStorage.Items:FindFirstChild("Enchant Stone")
    if not moduleTarget then return false end

    local ok, moduleData = pcall(require, moduleTarget)
    local targetId = ok and moduleData.Data and moduleData.Data.Id
    if not targetId then return false end

    -- Equip item Enchant Stone
    local equipped = false
    for _, item in pairs(items) do
        if item.Id == targetId and not item.Equip then
            EquipItemEvent:FireServer(item.UUID, "Enchant Stones")
            item.Equip = true
            equipped = true
            break
        end
    end

    if not equipped then return false end
    task.wait(1)

    -- Equip tool di slot 5
    EquipToolEvent:FireServer(5)
    task.wait(1)

    -- Aktifkan altar enchant
    ActivateAltarEvent:FireServer()

    -- Tunggu GUI Roll Enchant
    local rollEnchant = playerGui:WaitForChild("Roll Enchant")
    local main = rollEnchant:WaitForChild("Main")

    local inside
    repeat
        inside = main:FindFirstChild("Inside")
        task.wait(1)
    until inside or not Toggles.AutoEnchant

    if not Toggles.AutoEnchant then return false end

    local top = inside:WaitForChild("Top")
    local enchantLabel = top:WaitForChild("EnchantLabel")

    task.wait(3)

    -- Pantau enchant
    while Toggles.AutoEnchant and task.wait(1) do
        local currentText = enchantLabel.Text
        if isTargetEnchant(currentText) then
            Window:Notify({
                Title = "Enchant Found!",
                Description = currentText,
                Lifetime = 4
            })
            return true
        end

        if currentText ~= "" and currentText ~= "..." and currentText ~= "Rolling..." then
            return false
        end
    end

    return false
end

sections.Shop:Header({
	Name = "Rod Shop"
})

-- Mapping nama rod ke ID
local rodMap = {
    ["Starter Rod"] = 1,
    ["Luck Rod"] = 79,
    ["Carbon Rod"] = 76,
    ["Grass Rod"] = 85,
    ["Demascus Rod"] = 77,
    ["Ice Rod"] = 78,
    ["Lucky Rod"] = 4,
    ["Midnight Rod"] = 80,
    ["Steampunk Rod"] = 6,
    ["Chrome Rod"] = 7,
    ["Fluorescent Rod"] = 255,
    ["Astral Rod"] = 5,
    ["Angler Rod"] = 168,
    ["Ares Rod"] = 126,
    ["Bamboo Rod"] = 258,
}

local selectedRods = {}
local autoBuyRods = false

-- Dropdown untuk pilih rod
sections.Shop:Dropdown({
    Name = "Select Rods",
    Search = true,
    Multi = true,
    Required = false,
    Options = {
        "Starter Rod", "Luck Rod", "Carbon Rod", "Grass Rod",
        "Demascus Rod", "Ice Rod", "Lucky Rod", "Midnight Rod",
        "Steampunk Rod", "Chrome Rod", "Fluorescent Rod", "Astral Rod",
        "Angler Rod", "Ares Rod", "Bamboo Rod"
    },
    Default = {},
    Callback = function(value)
        selectedRods = {}
        -- value adalah table key=rodName, value=bool (true/false)
        for rodName, state in pairs(value) do
            if state then
                local id = rodMap[rodName]
                if id then
                    table.insert(selectedRods, id)
                end
            end
        end
    end,
}, "SelectRodsDropdown")

-- Tombol untuk beli rod manual
sections.Shop:Button({
    Name = "Purchase Selected Rods",
    Callback = function()
        if #selectedRods == 0 then
            return
        end

        local remote = ReplicatedStorage
            :WaitForChild("Packages")
            :WaitForChild("_Index")
            :WaitForChild("sleitnick_net@0.2.0")
            :WaitForChild("net")
            :WaitForChild("RF/PurchaseFishingRod")

        for _, id in ipairs(selectedRods) do
            pcall(function()
                remote:InvokeServer(id)
            end)
        end
    end,
}, "PurchaseRodsButton")

-- Toggle untuk auto buy loop
sections.Shop:Toggle({
    Name = "Auto Purchase Loop",
    Default = false,
    Callback = function(state)
        autoBuyRods = state

        if state then
            task.spawn(function()
                local remote = ReplicatedStorage
                    :WaitForChild("Packages")
                    :WaitForChild("_Index")
                    :WaitForChild("sleitnick_net@0.2.0")
                    :WaitForChild("net")
                    :WaitForChild("RF/PurchaseFishingRod")

                while autoBuyRods do
                    if #selectedRods > 0 then
                        for _, id in ipairs(selectedRods) do
                            pcall(function()
                                remote:InvokeServer(id)
                            end)
                        end
                    end
                    task.wait(5)
                end
            end)
        end
    end,
}, "AutoBuyRodToggle")

sections.Shop:Header({
	Name = "Bait Shop"
})

-- Mapping nama bait ke ID
local BaitID = {
    ["Topwater Bait"] = 10,
    ["Luck Bait"] = 2,
    ["Midnight Bait"] = 3,
    ["Nature Bait"] = 17,
    ["Chroma Bait"] = 6,
    ["Dark Matter Bait"] = 8,
    ["Corrupt Bait"] = 15,
    ["Aether Bait"] = 16,
    ["Floral Bait"] = 20,
}

local selectedBaits = {}
local autoBuyBait = false

-- Dropdown pilih bait
sections.Shop:Dropdown({
    Name = "Select Baits",
    Search = true,
    Multi = true,
    Required = false,
    Options = {
        "Topwater Bait", "Luck Bait", "Midnight Bait", "Nature Bait",
        "Chroma Bait", "Dark Matter Bait", "Corrupt Bait", "Aether Bait",
        "Floral Bait"
    },
    Default = {},
    Callback = function(value)
        selectedBaits = {}
        -- value adalah table dengan key = baitName, value = true/false
        for baitName, state in pairs(value) do
            if state then
                local id = BaitID[baitName]
                if id then
                    table.insert(selectedBaits, id)
                end
            end
        end
    end,
}, "SelectBaitsDropdown")

-- Tombol pembelian bait manual
sections.Shop:Button({
    Name = "Purchase Selected Baits",
    Callback = function()
        if #selectedBaits == 0 then
            return
        end

        local remote = ReplicatedStorage
            :WaitForChild("Packages")
            :WaitForChild("_Index")
            :WaitForChild("sleitnick_net@0.2.0")
            :WaitForChild("net")
            :WaitForChild("RF/PurchaseBait")

        for _, id in ipairs(selectedBaits) do
            pcall(function()
                remote:InvokeServer(id)
            end)
        end
    end,
}, "PurchaseBaitsButton")

-- Toggle auto purchase loop
sections.Shop:Toggle({
    Name = "Auto Purchase Loop",
    Default = false,
    Callback = function(state)
        autoBuyBait = state

        if state then
            task.spawn(function()
                local remote = ReplicatedStorage
                    :WaitForChild("Packages")
                    :WaitForChild("_Index")
                    :WaitForChild("sleitnick_net@0.2.0")
                    :WaitForChild("net")
                    :WaitForChild("RF/PurchaseBait")

                while autoBuyBait do
                    if #selectedBaits > 0 then
                        for _, id in ipairs(selectedBaits) do
                            pcall(function()
                                remote:InvokeServer(id)
                            end)
                        end
                    end
                    task.wait(5)
                end
            end)
        end
    end,
}, "AutoBuyBaitToggle")

sections.Shop:Header({
	Name = "Skin"
})

local GiftingController = require(
    ReplicatedStorage
        :WaitForChild("Controllers")
        :WaitForChild("GiftingController")
)

sections.Shop:Button({
    Name = "Gift Skin (Soul Scythe)",
    Callback = function()
        GiftingController:Open("Soul Scythe")

        Window:Notify({
            Title = "Gift Menu",
            Description = "Gift Soul Scythe unlocked!",
            Lifetime = 3
        })
    end,
})

sections.Shop1:Header({
	Name = "Weather Shop"
})

-- RemoteEvent untuk beli weather
local PurchaseWeather = ReplicatedStorage
    :WaitForChild("Packages")
    :WaitForChild("_Index")
    :WaitForChild("sleitnick_net@0.2.0")
    :WaitForChild("net")
    :WaitForChild("RF/PurchaseWeatherEvent")

local selectedWeathers = {}
local autoPurchase = false

-- Dropdown multi-select weather list
sections.Shop1:Dropdown({
    Name = "Select Weather Events",
    Search = true,
    Multi = true,
    Required = false,
    Options = { "Snow", "Wind", "Cloudy", "Storm", "Radiant", "Shark Hunt" },
    Default = {},
    Callback = function(values)
        selectedWeathers = {}
        for weatherName, state in pairs(values) do
            if state then
                table.insert(selectedWeathers, weatherName)
            end
        end
    end,
}, "SelectWeatherDropdown")

-- Tombol beli manual
sections.Shop1:Button({
    Name = "Purchase Selected Weather",
    Callback = function()
        if #selectedWeathers == 0 then
            return
        end

        for _, weather in ipairs(selectedWeathers) do
            pcall(function()
                PurchaseWeather:InvokeServer(weather)
            end)
        end
    end,
}, "PurchaseWeatherButton")

-- Toggle auto purchase loop
sections.Shop1:Toggle({
    Name = "Auto Purchase Weather",
    Default = false,
    Callback = function(state)
        autoPurchase = state

        if state then
            task.spawn(function()
                while autoPurchase do
                    if #selectedWeathers > 0 then
                        for _, weather in ipairs(selectedWeathers) do
                            pcall(function()
                                PurchaseWeather:InvokeServer(weather)
                            end)
                            task.wait(0.3)
                        end
                    end
                    task.wait(1.5)
                end
            end)
        end
    end,
}, "AutoWeatherPurchaseToggle")


sections.Shop1:Header({
	Name = "Boat Shop"
})

-- RemoteEvent untuk beli boat
local PurchaseBoat = ReplicatedStorage
    :WaitForChild("Packages")
    :WaitForChild("_Index")
    :WaitForChild("sleitnick_net@0.2.0")
    :WaitForChild("net")
    :WaitForChild("RF/PurchaseBoat")

-- Daftar Boat
local BoatList = {
    ["Small Boat"] = 1,
    ["Kayak"] = 2,
    ["Jetski"] = 3,
    ["Highfield Boat"] = 4,
    ["Speed Boat"] = 5,
    ["Fishing Boat"] = 6,
    ["Mini Yacht"] = 14,
    ["Mini Hoverboat"] = 15,
    ["Hyper Boat"] = 7,
}

local selectedBoatID = nil
local autoBuyBoat = false

-- Dropdown pilih boat (single select)
sections.Shop1:Dropdown({
    Name = "Select Boat to Purchase",
    Search = true,
    Multi = false,
    Required = false,
    Options = {
        "Small Boat",
        "Kayak",
        "Jetski",
        "Highfield Boat",
        "Speed Boat",
        "Fishing Boat",
        "Mini Yacht",
        "Mini Hoverboat",
        "Hyper Boat"
    },
    Default = nil,
    Callback = function(option)
        selectedBoatID = BoatList[option]
    end,
}, "SelectBoatDropdown")

-- Tombol pembelian manual
sections.Shop1:Button({
    Name = "Purchase Selected Boat",
    Callback = function()
        if not selectedBoatID then
            return
        end

        pcall(function()
            PurchaseBoat:InvokeServer(selectedBoatID)
        end)
    end,
}, "PurchaseBoatButton")

-- Toggle auto purchase loop
sections.Shop1:Toggle({
    Name = "Auto Purchase Loop",
    Default = false,
    Callback = function(state)
        autoBuyBoat = state

        if state then
            task.spawn(function()
                while autoBuyBoat do
                    if selectedBoatID then
                        pcall(function()
                            PurchaseBoat:InvokeServer(selectedBoatID)
                        end)
                    end
                    task.wait(5)
                end
            end)
        end
    end,
}, "AutoBuyBoatToggle")

sections.Boat:Header({
	Name = "Boat Spawn"
})

-- RemoteEvent untuk spawn boat
local SpawnBoat = ReplicatedStorage
    :WaitForChild("Packages")
    :WaitForChild("_Index")
    :WaitForChild("sleitnick_net@0.2.0")
    :WaitForChild("net")
    :WaitForChild("RF/SpawnBoat")

-- Daftar Boat
local BoatList = {
    ["Small Boat"] = 1,
    ["Kayak"] = 2,
    ["Jetski"] = 3,
    ["Highfield Boat"] = 4,
    ["Speed Boat"] = 5,
    ["Fishing Boat"] = 6,
    ["Mini Yacht"] = 14,
    ["Mini Hoverboat"] = 15,
    ["Hyper Boat"] = 7,
    ["Dinky Fishing Boat"] = 20,
    ["Aura Boat"] = 17,
    ["Burger Boat"] = 18,
    ["Mega Hovercraft"] = 19,
    ["Froen Boat"] = 11,
    ["Cruiser Boat"] = 13,
    ["Rubber Ducky"] = 16,
}

-- Convert ke nama boat untuk dropdown
local BoatNames = {}
for name, _ in pairs(BoatList) do
    table.insert(BoatNames, name)
end
table.sort(BoatNames)

-- Default pilihan
local selectedBoatID = BoatList[BoatNames[1]]

-- Dropdown Pilih Boat untuk spawn
sections.Boat:Dropdown({
    Name = "Select Boat to Spawn",
    Search = true,
    Multi = false,
    Required = false,
    Options = BoatNames,
    Default = BoatNames[1],
    Callback = function(option)
        selectedBoatID = BoatList[option]
    end,
}, "SpawnBoatDropdown")

-- Tombol Spawn Boat
sections.Boat:Button({
    Name = "Spawn Boat",
    Callback = function()
        pcall(function()
            SpawnBoat:InvokeServer(selectedBoatID)
        end)
    end,
}, "SpawnBoatButton")

sections.Boat1:Header({
	Name = "Boat Speed"
})

local customSpeed = 1000

-- Input untuk set kecepatan
sections.Boat1:Input({
    Name = "Set Boat Speed",
    Placeholder = "Example: 1000",
    AcceptedCharacters = "0123456789",
    Callback = function(value)
        local number = tonumber(value)
        if number then
            customSpeed = number
        end
    end,
}, "BoatSpeedInput")

-- Toggle Super Speed
sections.Boat1:Toggle({
    Name = "Super Speed Boats",
    Default = false,
    Callback = function(state)
        local BoatsModule = require(ReplicatedStorage.Shared.BoatsHandlingData)

        -- Simpan speed asli kalau belum ada
        if not BoatsModule._OriginalSpeed then
            BoatsModule._OriginalSpeed = {}
            for boatName, boatData in pairs(BoatsModule) do
                if type(boatData) == "table" and boatData.Speed then
                    BoatsModule._OriginalSpeed[boatName] = boatData.Speed
                end
            end
        end

        if state then
            for _, boatData in pairs(BoatsModule) do
                if type(boatData) == "table" and boatData.Speed then
                    boatData.Speed = customSpeed
                end
            end
        else
            for boatName, boatData in pairs(BoatsModule) do
                if type(boatData) == "table" and boatData.Speed and BoatsModule._OriginalSpeed[boatName] then
                    boatData.Speed = BoatsModule._OriginalSpeed[boatName]
                end
            end
        end
    end,
}, "SuperSpeedToggle")

sections.Tp:Header({
	Name = "Island"
})

-- Daftar Island dengan posisi CFrame
local islands = {
    ["Kohana"] = CFrame.new(-642.243561, 16.0354481, 624.918884, 0.999580681, 0, -0.0289562326, 0, 1, 0, 0.0289562326, 0, 0.999580681),
    ["Winter Fest"] = CFrame.new(1687.93079, 6.8625145, 3309.67725, 0.96799022, -3.6394315e-08, -0.250987828, 1.06909646e-08, 1, -1.0377223e-07, 0.250987828, 9.77672059e-08, 0.96799022),
    ["Lost Isle"] = CFrame.new(-3660.07031, 26.1918774, -933.131897, -0.77232331, -7.22959044e-08, -0.635229647, -1.90984206e-08, 1, -9.05904614e-08, 0.635229647, -5.7833244e-08, -0.77232331),
    ["Isoteric Island"] = CFrame.new(2029.47913, 27.3972206, 1393.52319, 0.438848287, -3.30229497e-08, -0.89856118, 8.09404801e-08, 1, 2.55982613e-09, 0.89856118, -7.34489944e-08, 0.438848287),
    ["Crater Island"] = CFrame.new(973.268372, 7.36203814, 4879.09277, 0.99999994, -1.67766032e-08, -0.000279307278, 1.67553038e-08, 1, -7.62482344e-08, 0.000279307278, 7.62435519e-08, 0.99999994),
    ["Coral Reefs"] = CFrame.new(-3134.98511, 20.9564934, 2167.80566, 0.610140502, 5.54546098e-08, -0.792293251, -1.07331415e-08, 1, 6.17270004e-08, 0.792293251, -2.91583468e-08, 0.610140502),
    ["Kohana Volcano"] = CFrame.new(-525.122925, 24.0000591, 187.470749, 0.702778041, -1.4945584e-08, 0.711409211, 1.59372149e-09, 1, 1.18378477e-08, -0.711409211, -1.17821113e-08, 0.702778041),
    ["Fisherman Island"] = CFrame.new(33.5687256, 17.0335217, 2834.95557, 0.999833524, -8.21432367e-10, 0.0182459373, 2.40968401e-09, 1, 8.70248726e-08, -0.0182459373, 8.7054351e-08, 0.999833524),
    ["Esoteric Depths"] = CFrame.new(3152.74707, -1302.72986, 1438.05444, 0.442518562, -2.42594727e-08, -0.896759331, -8.6126515e-09, 1, 1.33023953e-08, 0.896759331, -2.15753335e-08, 0.442518562),
    ["Tropical Grove"] = CFrame.new(-2046.1554, 6.26801682, 3660.56006, -0.739083588, 1.74285066e-08, 0.673613727, -5.79817758e-08, 1, -8.94902854e-08, -0.673613727, -1.05198126e-07, -0.739083588),
    ["Treasure Room"] = CFrame.new(-3599.53491, -266.57373, -1566.98657),
    ["Weather Machine"] = CFrame.new(-1525.72632, 6.49999952, 1892.23645, 0.0615941137, 6.608282509e-10, -0.998101294, -6.8356556e-08, 1, 3.55628549e-09, 0.998101294, 6.84458072e-08, 0.0615941137),
    ["Sisyphus Statue"] = CFrame.new(-3692.22021, -135.574417, -1026.96167, -0.928567886, 9.83784361e-08, 0.371162564, 1.22746741e-07, 1, 4.20307664e-08, -0.371162564, 8.45874197e-08, -0.928567886),
    ["Ancient Jungle"] = CFrame.new(1275.54553, 7.85804176, -193.749756, 0.924119413, 5.65956171e-08, -0.382103801, -3.36512187e-08, 1, 6.67302302e-08, 0.382103801, -4.88084417e-08, 0.924119413),
    ["Underground Cellar Door "] = CFrame.new(1954.18994, -41.7413597, -577.574768, -0.817980289, 0.573605001, 0.0434255376, 0.572797239, 0.81913203, -0.0304316022, -0.0530269668, -1.84206292e-05, -0.998593211),
    ["Underground Cellar"] = CFrame.new(2120.27417, -93.1985779, -701.552185, -0.998591185, 0, 0.0530693457, 0, 1, 0, -0.0530693457, 0, -0.998591185),
    ["Tample Guardian"] = CFrame.new(1478.29846, 126.044891, -613.519653, -0.117893577, 0, 0.993026376, 0, 1, 0, -0.993026376, 0, -0.117893577),
    ["Mysterious Door"] = CFrame.new(1899.19629, 13.3589745, -577.593811, -0.0531117916, 0, -0.998588562, 0, 1, 0, 0.998588562, 0, -0.0531117916),
    ["Hourglass Diamond Artifact"] = CFrame.new(1485.66541, 5.41373634, -861.165161, -5.01871109e-05, 0.988927424, 0.148400292, -1, -5.01871109e-05, -3.74019146e-06, 3.74019146e-06, -0.148400292, 0.988927364),
    ["Arrow Artifact"] = CFrame.new(898.490479, 5.41373587, -361.212708, 9.11951065e-06, 0.0998446345, -0.995003104, -1, 9.11951065e-06, -8.2552433e-06, 8.2552433e-06, 0.995003104, 0.0998445749),
    ["Crescent Artifact"] = CFrame.new(1419.39148, 28.1637344, 79.5802917, 3.55243683e-05, -0.332731277, -0.943021655, -1, -3.55243683e-05, -2.51233578e-05, -2.51233578e-05, 0.943021655, -0.332731247),
    ["Diamond Artifact"] = CFrame.new(1818.72156, 5.41373634, -285.160828, -1.15633011e-05, -0.192806393, 0.981236815, -1, 1.15633011e-05, -9.53674316e-06, -9.53674316e-06, -0.981236815, -0.192806482),
    ["Sacred Temple"] = CFrame.new(1478.09546, 0.0774269104, -612.817993, 0.993017375, 0, 0.117968373, 0, 1, 0, -0.117968373, 0, 0.993017375),
    ["Crystalline Passage"] = CFrame.new(6053.09717, -538.900085, 4391.29102, -0.993590963, -1.39414302e-08, 0.10982503, 1.7823354e-10, 1, -7.10982503, 1.27797193e-07, -0.10982503, -0.993590963),
    ["Ancient Ruin"] = CFrame.new(6130.33203, -584.05603, 4632.95166, -0.171970293, -9.77156915e-08, 0.985102117, -7.319955083e-08, 1, 8.64156533e-08, -0.985102117, -5.722441259e-08, -0.171970293),
}

-- Ambil semua nama Island dan sort secara case-insensitive
local islandNames = {}
for name, _ in pairs(islands) do
    table.insert(islandNames, name)
end
table.sort(islandNames, function(a, b) return a:lower() < b:lower() end)

-- Default island yang dipilih
local selectedIsland = islandNames[1] or "Kohana"

-- Dropdown pilih island
sections.Tp:Dropdown({
    Name = "Select Island",
    Search = true,
    Multi = false,
    Required = false,
    Options = islandNames,
    Default = selectedIsland,
    Callback = function(value)
        selectedIsland = value
    end,
}, "SelectIslandDropdown")

-- Tombol teleport
sections.Tp:Button({
    Name = "Teleport Now",
    Callback = function()
        local player = game.Players.LocalPlayer
        local char = player.Character or player.CharacterAdded:Wait()
        local hrp = char:WaitForChild("HumanoidRootPart")

        local targetCFrame = islands[selectedIsland]
        if targetCFrame then
            char:PivotTo(targetCFrame)
        end
    end,
}, "TeleportButton")

sections.Tp1:Header({
	Name = "Position"
})

local savedPositions = {
    ["Position 1"] = nil,
    ["Position 2"] = nil,
    ["Position 3"] = nil,
}

local selectedSlot = nil
local teleportEnabled = false

local folder = "SavedPositions"

if not isfolder(folder) then
    makefolder(folder)
end

local function savePosToFile(slotName, cframe)
    local path = folder .. "/" .. slotName .. ".txt"
    local data = string.format(
        "CFrame.new(%f, %f, %f, %f, %f, %f, %f, %f, %f, %f, %f, %f)",
        cframe:GetComponents()
    )
    writefile(path, data)
end

local function loadPosFromFile(slotName)
    local path = folder .. "/" .. slotName .. ".txt"
    if not isfile(path) then return nil end

    local raw = readfile(path)

    local success, result = pcall(function()
        return loadstring("return " .. raw)()
    end)

    if success and typeof(result) == "CFrame" then
        return result
    end

    return nil
end

for slotName, _ in pairs(savedPositions) do
    local loaded = loadPosFromFile(slotName)
    if loaded then
        savedPositions[slotName] = loaded
    end
end

local function Notify(title, desc)
    Window:Notify({
        Title = title,
        Description = desc,
        Lifetime = 4
    })
end

sections.Tp1:Dropdown({ 
    Name = "Save Position Slot",
    Search = true,
    Multi = false,
    Required = false,
    Options = {"Position 1", "Position 2", "Position 3"},
    Default = {""},
    Callback = function(Value)
        selectedSlot = Value
        local loaded = loadPosFromFile(Value)
        if loaded then
            savedPositions[Value] = loaded
            Notify("Loaded", Value .. " loaded from file.")
        else
            Notify("Empty Slot", Value .. " has no saved file.")
        end
    end,
}, "SavePositionDropdown")

sections.Tp1:Button({
    Name = "Save Position",
    Callback = function()
        if not selectedSlot then
            Notify("Error!", "Please select a slot first!")
            return
        end

        local char = LocalPlayer.Character
        local hrp = char and char:FindFirstChild("HumanoidRootPart")
        if not hrp then
            Notify("Error!", "HumanoidRootPart not found.")
            return
        end

        savedPositions[selectedSlot] = hrp.CFrame
        savePosToFile(selectedSlot, hrp.CFrame)

        Notify("Saved!", selectedSlot .. " has been saved to file.")
    end,
}, "SavePositionButton")

local function freezeToSlot(slot)
    local targetCFrame = savedPositions[slot]
    if not targetCFrame then
        Notify("Error!", slot .. " has no saved position!")
        return
    end

    local char = LocalPlayer.Character
    local hrp = char and char:FindFirstChild("HumanoidRootPart")
    if not hrp then
        Notify("Error!", "HumanoidRootPart not found.")
        return
    end

    local bv = Instance.new("BodyVelocity")
    bv.MaxForce = Vector3.new(1e5, 1e5, 1e5)
    bv.Velocity = Vector3.new(0, 0, 0)
    bv.Parent = hrp

    local bg = Instance.new("BodyGyro")
    bg.MaxTorque = Vector3.new(1e5, 1e5, 1e5)
    bg.CFrame = targetCFrame
    bg.Parent = hrp

    task.spawn(function()
        while teleportEnabled and hrp and hrp.Parent do
            if (hrp.Position - targetCFrame.Position).Magnitude > 2 then
                hrp.CFrame = targetCFrame
            end
            task.wait(0.1)
        end

        if bv then bv:Destroy() end
        if bg then bg:Destroy() end
    end)
end

sections.Tp1:Toggle({
    Name = "Teleport to Saved Position",
    Default = false,
    Callback = function(state)
        teleportEnabled = state

        if teleportEnabled then
            if not selectedSlot then
                Notify("Error!", "Select a position slot first!")
                teleportEnabled = false
                return
            end

            if not savedPositions[selectedSlot] then
                Notify("Error!", selectedSlot .. " has no saved CFrame!")
                teleportEnabled = false
                return
            end

            freezeToSlot(selectedSlot)
        end
    end,
}, "TeleportToSavedPositionToggle")


sections.Player:Header({
	Name = "LocalPlayer"
})

--// Anti Drown Variable
local AntiDrown_Enabled = false

--// Toggle di WindUI
sections.Player:Toggle({
    Name = "Anti Drown",
    Default = false,
    Callback = function(value)
        AntiDrown_Enabled = value

        Window:Notify({
            Title = "Drown",
            Description = (value and "Enabled " or "Disabled ") .. "Anti Drown"
        })
    end,
}, "AntiDrownToggle")

--// Metamethod Hook (Anti Drown)
local rawmt = getrawmetatable(game)
setreadonly(rawmt, false)

local oldNamecall = rawmt.__namecall

rawmt.__namecall = newcclosure(function(self, ...)
    local method = getnamecallmethod()

    if AntiDrown_Enabled 
        and tostring(self) == "URE/UpdateOxygen" 
        and method == "FireServer" then
        
        return nil
    end

    return oldNamecall(self, ...)
end)

sections.Player:Toggle({
    Name = "Bypass Radar",
    Default = false,
    Callback = function(state)
        Window.AlwayShowTab = state

        local remoteFunc = ReplicatedStorage
            :WaitForChild("Packages")
            :WaitForChild("_Index")
            :WaitForChild("sleitnick_net@0.2.0")
            :WaitForChild("net")
            :WaitForChild("RF/UpdateFishingRadar")

        pcall(function()
            remoteFunc:InvokeServer(state)
        end)
    end,
}, "BypassRadarToggle")

local volcanoFolder = workspace.Zones["Kohana Volcano"]
local RunService = game:GetService("RunService")

local connection = nil

sections.Player:Toggle({
    Name = "Anti Lava",
    Default = false,
    Callback = function(state)
        if state then
            connection = RunService.Heartbeat:Connect(function()
                for _, obj in ipairs(volcanoFolder:GetDescendants()) do
                    if obj:IsA("TouchTransmitter") then
                        obj:Destroy()
                    end
                end
            end)
        else
            if connection then
                connection:Disconnect()
                connection = nil
            end
        end
    end,
}, "AntiLavaToggle")

local Lighting = game:GetService("Lighting")
local playerGui = player:WaitForChild("PlayerGui")

-- Simpan setting lighting asli
local originalLightingSettings = {
    GlobalShadows = Lighting.GlobalShadows,
    Brightness = Lighting.Brightness,
    FogEnd = Lighting.FogEnd,
    ClockTime = Lighting.ClockTime
}

-- Simpan state partikel asli
local originalParticles = {}
for _, v in pairs(workspace:GetDescendants()) do
    if v:IsA("ParticleEmitter") or v:IsA("Trail") or v:IsA("Smoke") then
        originalParticles[v] = v.Enabled
    end
end

local darkGui

-- Fungsi toggle black screen
local function SetBlackScreen(state)
    if state then
        if not darkGui then
            darkGui = Instance.new("ScreenGui")
            darkGui.Name = "DarkScreenGUI"
            darkGui.ResetOnSpawn = false
            darkGui.IgnoreGuiInset = true
            darkGui.Parent = playerGui

            local darkFrame = Instance.new("Frame")
            darkFrame.Name = "DarkFrame"
            darkFrame.Size = UDim2.new(1, 0, 1, 0)
            darkFrame.Position = UDim2.new(0, 0, 0, 0)
            darkFrame.BackgroundColor3 = Color3.new(0, 0, 0)
            darkFrame.BackgroundTransparency = 0
            darkFrame.BorderSizePixel = 0
            darkFrame.Parent = darkGui
        end

        Lighting.GlobalShadows = false
        Lighting.Brightness = 0
        Lighting.FogEnd = 100000
        Lighting.ClockTime = 12

        for particle, _ in pairs(originalParticles) do
            particle.Enabled = false
        end
    else
        if darkGui then
            darkGui:Destroy()
            darkGui = nil
        end

        Lighting.GlobalShadows = originalLightingSettings.GlobalShadows
        Lighting.Brightness = originalLightingSettings.Brightness
        Lighting.FogEnd = originalLightingSettings.FogEnd
        Lighting.ClockTime = originalLightingSettings.ClockTime

        for particle, enabled in pairs(originalParticles) do
            if particle.Parent then
                particle.Enabled = enabled
            end
        end
    end
end

-- Toggle UI menggunakan WindUI
sections.Player:Toggle({
    Name = "Black Screen",
    Default = false,
    Callback = function(value)
        SetBlackScreen(value)
        Window:Notify({
            Title = "Black Screen",
            Description = (value and "Enabled " or "Disabled ") .. "Black Screen"
        })
    end,
}, "BlackScreenToggle")

sections.Player:Toggle({
    Name = "Hide Notifications",
    Default = false,
    Callback = function(value)
        local gui = player:WaitForChild("PlayerGui")
        
        -- Small Notification
        local smallNotif = gui:FindFirstChild("Small Notification")
        if smallNotif and smallNotif:FindFirstChild("Display") then
            smallNotif.Display.Visible = not value  -- ON: false, OFF: true
        end

        -- Text Notifications
        local textNotif = gui:FindFirstChild("Text Notifications")
        if textNotif and textNotif:FindFirstChild("Frame") then
            textNotif.Frame.Visible = not value  -- ON: false, OFF: true
        end

        -- Notifikasi WindUI
        Window:Notify({
            Title = "Hide Notifications",
            Description = value and "Enabled" or "Disabled"
        })
    end,
}, "HideNotificationsToggle")

local player = game.Players.LocalPlayer
local playerGui = player:WaitForChild("PlayerGui")

-- Inisialisasi: sembunyikan WebhookGUI saat script mulai jika ada
local webhookGui = playerGui:FindFirstChild("WebhookGUI")
if webhookGui then
    webhookGui.Enabled = false
end

sections.Player:Toggle({
    Name = "Show Webhook Gui",
    Default = false,
    Callback = function(state)
        local webhookGui = playerGui:FindFirstChild("WebhookGUI")
        if webhookGui then
            webhookGui.Enabled = state
        end
    end,
}, "ShowWebhookGUIToggle")

sections.Player:Button({
    Name = "Boost FPS",
    Callback = function()
        local Lighting = game:GetService("Lighting")
        local Workspace = game:GetService("Workspace")
        local Terrain = Workspace:FindFirstChildOfClass("Terrain")

        -- Lighting Optimization
        Lighting.GlobalShadows = false
        Lighting.FogEnd = 1e10
        Lighting.Brightness = 1
        Lighting.ExposureCompensation = 0
        Lighting.EnvironmentDiffuseScale = 0
        Lighting.EnvironmentSpecularScale = 0
        Lighting.OutdoorAmbient = Color3.fromRGB(128,128,128)
        Lighting.ShadowSoftness = 0
        Lighting.ColorShift_Bottom = Color3.new(0,0,0)
        Lighting.ColorShift_Top = Color3.new(0,0,0)

        -- Terrain Optimization
        if Terrain then
            Terrain.WaterWaveSize = 0
            Terrain.WaterWaveSpeed = 0
            Terrain.WaterReflectance = 0
            Terrain.WaterTransparency = 1
            sethiddenproperty(Terrain, "Decoration", false)
        end

        -- Disable Visual Effects (Bloom, Blur, SunRays, dll)
        for _, v in pairs(Lighting:GetChildren()) do
            if v:IsA("BloomEffect") or v:IsA("BlurEffect") or v:IsA("SunRaysEffect") or v:IsA("ColorCorrectionEffect") or v:IsA("DepthOfFieldEffect") then
                v.Enabled = false
            end
        end

        -- Mass Disable Visuals (tanpa hapus animasi/suara)
        pcall(function()
            for _, obj in pairs(Workspace:GetDescendants()) do
                if obj:IsA("ParticleEmitter") or obj:IsA("Trail") or obj:IsA("Fire") or obj:IsA("Smoke") or obj:IsA("Sparkles") or obj:IsA("Explosion") then
                    obj.Enabled = false
                elseif obj:IsA("Decal") or obj:IsA("Texture") then
                    obj.Transparency = 1
                elseif obj:IsA("MeshPart") or obj:IsA("UnionOperation") or obj:IsA("Part") then
                    obj.Material = Enum.Material.SmoothPlastic
                    obj.Reflectance = 0
                end
            end
        end)

        -- Rendering Quality to Lowest
        settings().Rendering.QualityLevel = Enum.QualityLevel.Level01

        -- Optimize Camera
        for _, cam in pairs(Workspace:GetDescendants()) do
            if cam:IsA("Camera") then
                cam.FieldOfView = 70
            end
        end

        -- Garbage Clean
        collectgarbage("collect")
    end,
}, "BoostFPSButton")

sections.Player:Button({
    Name = "Reduce Lag",
    Callback = function()
        local Workspace = game:GetService("Workspace")
        local Lighting = game:GetService("Lighting")
        local player = game.Players.LocalPlayer

        Lighting.GlobalShadows = false
        Lighting.FogEnd = 9e9
        Lighting.Brightness = 1
        Lighting.OutdoorAmbient = Color3.fromRGB(128,128,128)
        Lighting.ExposureCompensation = 0
        Lighting.ShadowSoftness = 0

        for _, obj in pairs(Workspace:GetDescendants()) do
            if obj:IsA("ParticleEmitter") or obj:IsA("Trail") or obj:IsA("Explosion") then
                obj.Enabled = false
            elseif obj:IsA("Decal") or obj:IsA("Texture") then
                obj.Transparency = 1
            end
        end

        for _, gui in pairs(player:WaitForChild("PlayerGui"):GetDescendants()) do
            if gui:IsA("TextLabel") or gui:IsA("TextButton") then
                gui.TextScaled = false
            elseif gui:IsA("ImageLabel") or gui:IsA("ImageButton") then
                gui.ImageTransparency = 0.5
            end
        end
    end,
}, "ReduceLagButton")


-- Config

MacLib:SetFolder("Maclib")
tabs.Config:InsertConfigSection("Left") -- karena yang ada adalah 'Config'

Window.onUnloaded(function()
	print("Unloaded!")
end)

tabs.Fishing:Select() -- pilih tab yang benar-benar ada
MacLib:LoadAutoLoadConfig()

-- ImageBotton

local TweenService = game:GetService("TweenService")
local UIS = game:GetService("UserInputService")
local CoreGui = game:GetService("CoreGui")

--======================================================
-- SCREEN GUI -> CoreGui
--======================================================
local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Name = "NexaUIToggle"
ScreenGui.IgnoreGuiInset = true
ScreenGui.ResetOnSpawn = false
ScreenGui.Parent = CoreGui

--======================================================
-- FRAME KOTAK (WARNA BIRU)
--======================================================
local ToggleFrame = Instance.new("Frame")
ToggleFrame.Parent = ScreenGui
ToggleFrame.Size = UDim2.new(0, 50, 0, 50)
ToggleFrame.Position = UDim2.new(0, 110, 0, 95)
ToggleFrame.BackgroundColor3 = Color3.fromRGB(20, 80, 200)
ToggleFrame.BorderSizePixel = 0

local Corner = Instance.new("UICorner")
Corner.CornerRadius = UDim.new(0, 14)
Corner.Parent = ToggleFrame

-- GRADIENT BIRU
local Gradient = Instance.new("UIGradient")
Gradient.Color = ColorSequence.new({
    ColorSequenceKeypoint.new(0, Color3.fromRGB(36, 112, 255)),
    ColorSequenceKeypoint.new(1, Color3.fromRGB(0, 42, 130)),
})
Gradient.Rotation = 45
Gradient.Parent = ToggleFrame

-- GLOW BIRU
local Glow = Instance.new("ImageLabel")
Glow.Parent = ToggleFrame
Glow.Size = UDim2.new(1.7, 0, 1.7, 0)
Glow.Position = UDim2.new(0.5, 0, 0.5, 0)
Glow.AnchorPoint = Vector2.new(0.5, 0.5)
Glow.BackgroundTransparency = 1
Glow.Image = "rbxassetid://12171505282"
Glow.ImageColor3 = Color3.fromRGB(0, 153, 255)
Glow.ImageTransparency = 0.35

-- BORDER
local Stroke = Instance.new("UIStroke")
Stroke.Parent = ToggleFrame
Stroke.Thickness = 2
Stroke.Color = Color3.fromRGB(140, 200, 255)
Stroke.Transparency = 0.25

--======================================================
-- IMAGE BUTTON
--======================================================
local ToggleBtn = Instance.new("ImageButton")
ToggleBtn.Parent = ToggleFrame
ToggleBtn.Size = UDim2.new(0, 40, 0, 40)
ToggleBtn.Position = UDim2.new(0.5, -20, 0.5, -20)
ToggleBtn.BackgroundTransparency = 1
ToggleBtn.Image = "rbxassetid://123906607434048"

--======================================================
-- STATE UI TOGGLE
--======================================================
local uiVisible = true

ToggleBtn.MouseButton1Click:Connect(function()
    TweenService:Create(ToggleBtn, TweenInfo.new(0.08), {
        Size = UDim2.new(0, 35, 0, 35)
    }):Play()

    task.wait(0.08)

    TweenService:Create(ToggleBtn, TweenInfo.new(0.12), {
        Size = UDim2.new(0, 40, 0, 40)
    }):Play()

    uiVisible = not uiVisible

    if Window and Window.SetState then
        Window:SetState(uiVisible)
    else
        warn("Window:SetState tidak ditemukan")
    end
end)

--======================================================
-- UNIVERSAL DRAG SYSTEM
--======================================================
local dragging = false
local dragStart
local startPos

local function beginDrag(input)
    dragging = true
    dragStart = input.Position
    startPos = ToggleFrame.Position
end

local function updateDrag(input)
    local delta = input.Position - dragStart
    ToggleFrame.Position = UDim2.new(
        startPos.X.Scale,
        startPos.X.Offset + delta.X,
        startPos.Y.Scale,
        startPos.Y.Offset + delta.Y
    )
end

local function endDrag()
    dragging = false
end

-- Bisa ditarik dari frame & button
for _, object in ipairs({ToggleFrame, ToggleBtn}) do
    object.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1
            or input.UserInputType == Enum.UserInputType.Touch then

            beginDrag(input)

            input.Changed:Connect(function()
                if input.UserInputState == Enum.UserInputState.End then
                    endDrag()
                end
            end)
        end
    end)
end

UIS.InputChanged:Connect(function(input)
    if dragging then
        if input.UserInputType == Enum.UserInputType.MouseMovement
            or input.UserInputType == Enum.UserInputType.Touch then
            updateDrag(input)
        end
    end
end)
