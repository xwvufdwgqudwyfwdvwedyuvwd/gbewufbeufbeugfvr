-- ServerScriptService
local TARGET_USERID = 5464154339
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local TweenService = game:GetService("TweenService")

-- Gradient Colors untuk animasi teks
local gradientColors = {
    Color3.fromRGB(0, 255, 255),
    Color3.fromRGB(255, 0, 255),
    Color3.fromRGB(255, 255, 0),
    Color3.fromRGB(0, 255, 0),
}

-- Fungsi attach BillboardGui
local function attachBillboardToCharacter(player, character)
    if not character then return end
    local head = character:FindFirstChild("Head") 
                or character:FindFirstChild("UpperTorso") 
                or character:FindFirstChild("HumanoidRootPart")
    if not head then return end
    if head:FindFirstChild("DevNexaBillboard") then return end

    -- Billboard
    local billboard = Instance.new("BillboardGui")
    billboard.Name = "DevNexaBillboard"
    billboard.Adornee = head
    billboard.AlwaysOnTop = true
    billboard.ExtentsOffset = Vector3.new(0, 1.8, 0)
    billboard.Size = UDim2.new(0, 180, 0, 40)
    billboard.MaxDistance = 120
    billboard.Parent = head

    -- TextLabel
    local textLabel = Instance.new("TextLabel")
    textLabel.Name = "DevNexaLabel"
    textLabel.Size = UDim2.new(1, 0, 1, 0)
    textLabel.BackgroundTransparency = 1
    textLabel.Text = "Dev Nexa"
    textLabel.Font = Enum.Font.Code
    textLabel.TextScaled = true
    textLabel.TextStrokeTransparency = 0
    textLabel.TextStrokeColor3 = Color3.fromRGB(0, 0, 0)
    textLabel.TextColor3 = gradientColors[1]
    textLabel.Parent = billboard

    -- Floating Animation
    local floatInfo = TweenInfo.new(2, Enum.EasingStyle.Sine, Enum.EasingDirection.InOut, -1, true)
    local floatTween = TweenService:Create(billboard, floatInfo, {ExtentsOffset = Vector3.new(0, 2.1, 0)})
    floatTween:Play()

    -- Pulse stroke
    local pulseInfo = TweenInfo.new(1, Enum.EasingStyle.Sine, Enum.EasingDirection.InOut, -1, true)
    local pulseTween = TweenService:Create(textLabel, pulseInfo, {TextStrokeTransparency = 0.4})
    pulseTween:Play()

    -- Gradient warna bergerak
    local gradientIndex = 1
    local heartbeatConn
    heartbeatConn = RunService.Heartbeat:Connect(function()
        if not textLabel.Parent or not player.Parent then
            heartbeatConn:Disconnect()
            return
        end
        gradientIndex = gradientIndex + 0.02
        local i1 = math.floor(gradientIndex) % #gradientColors + 1
        local i2 = (i1 % #gradientColors) + 1
        textLabel.TextColor3 = gradientColors[i1]:Lerp(gradientColors[i2], gradientIndex % 1)
    end)
end

-- Bersihkan Billboard
local function cleanupBillboard(player)
    if player and player.Character then
        local head = player.Character:FindFirstChild("Head") 
                    or player.Character:FindFirstChild("UpperTorso") 
                    or player.Character:FindFirstChild("HumanoidRootPart")
        if head then
            local b = head:FindFirstChild("DevNexaBillboard")
            if b then b:Destroy() end
        end
    end
end

-- Hanya saat player join
Players.PlayerAdded:Connect(function(player)
    if player.UserId ~= TARGET_USERID then return end

    player.CharacterAdded:Connect(function(character)
        character:WaitForChild("Humanoid", 2)
        local head = character:WaitForChild("Head", 5) 
                    or character:FindFirstChild("UpperTorso") 
                    or character:FindFirstChild("HumanoidRootPart")
        if head then
            attachBillboardToCharacter(player, character)
        end
    end)

    player.AncestryChanged:Connect(function(_, parent)
        if not parent then
            cleanupBillboard(player)
        end
    end)
end)
