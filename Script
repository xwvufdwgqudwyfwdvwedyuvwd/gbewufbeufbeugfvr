-- =======================================================
--          CONTROLLER TANPA _G (FINAL CLEAN VERSION)
-- =======================================================

-- ============= KONFIGURASI (EDIT SESUAI KEBUTUHAN) =============
local StartActive = true
local ErrorMessage = "ERROR: Script telah dinonaktifkan.\nAnda akan dikeluarkan."
local KickDelaySeconds = 5
local ShouldKick = true


-- ============= INTERNAL STATE (PRIVATE) =============
local ScriptActive = StartActive
local Locked = false

local player = game:GetService("Players").LocalPlayer
local PlayerGui = player:WaitForChild("PlayerGui")


-- ============= GUI SETUP =============
local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Name = "ScriptStatusGui_Error"
ScreenGui.IgnoreGuiInset = true
ScreenGui.ResetOnSpawn = false
ScreenGui.Parent = PlayerGui

local Background = Instance.new("Frame")
Background.Size = UDim2.new(1, 0, 1, 0)
Background.BackgroundColor3 = Color3.fromRGB(10, 10, 10)
Background.BackgroundTransparency = 0.4
Background.Visible = false
Background.ZIndex = 9999
Background.Parent = ScreenGui

local Card = Instance.new("Frame")
Card.Size = UDim2.new(0, 520, 0, 150)
Card.Position = UDim2.fromScale(0.5, 0.3)
Card.AnchorPoint = Vector2.new(0.5, 0.5)
Card.BackgroundColor3 = Color3.fromRGB(45, 15, 15)
Card.BorderSizePixel = 0
Card.ZIndex = 10000
Card.Parent = Background

local Title = Instance.new("TextLabel")
Title.Size = UDim2.new(1, -20, 0, 40)
Title.Position = UDim2.new(0, 10, 0, 10)
Title.BackgroundTransparency = 1
Title.Text = "â— SCRIPT ERROR"
Title.Font = Enum.Font.GothamBold
Title.TextSize = 28
Title.TextColor3 = Color3.fromRGB(255, 180, 180)
Title.TextXAlignment = Enum.TextXAlignment.Left
Title.ZIndex = 10000
Title.Parent = Card

local MessageLabel = Instance.new("TextLabel")
MessageLabel.Size = UDim2.new(1, -20, 0, 70)
MessageLabel.Position = UDim2.new(0, 10, 0, 55)
MessageLabel.BackgroundTransparency = 1
MessageLabel.TextWrapped = true
MessageLabel.Text = ErrorMessage
MessageLabel.Font = Enum.Font.Gotham
MessageLabel.TextSize = 20
MessageLabel.TextColor3 = Color3.fromRGB(255, 130, 130)
MessageLabel.TextXAlignment = Enum.TextXAlignment.Left
MessageLabel.TextYAlignment = Enum.TextYAlignment.Top
MessageLabel.ZIndex = 10000
MessageLabel.Parent = Card

local Footer = Instance.new("TextLabel")
Footer.Size = UDim2.new(1, -20, 0, 20)
Footer.Position = UDim2.new(0, 10, 1, -25)
Footer.BackgroundTransparency = 1
Footer.Text = ("Anda akan dikeluarkan dalam %d detik..."):format(KickDelaySeconds)
Footer.Font = Enum.Font.Gotham
Footer.TextSize = 16
Footer.TextColor3 = Color3.fromRGB(220, 130, 130)
Footer.TextXAlignment = Enum.TextXAlignment.Left
Footer.ZIndex = 10000
Footer.Parent = Card


-- ============= FUNGSI UTAMA =============
local function IsActive()
    return ScriptActive
end

local function KickCountdown()
    if not ShouldKick then return end

    task.spawn(function()
        local remaining = KickDelaySeconds
        while remaining > 0 do
            pcall(function()
                Footer.Text = ("Anda akan dikeluarkan dalam %d detik..."):format(remaining)
            end)
            task.wait(1)
            remaining -= 1
        end

        if not ScriptActive and Locked then
            pcall(function()
                player:Kick(ErrorMessage)
            end)
        end
    end)
end

local function SetActive(state)
    if state == true then
        if Locked then
            warn("Attempt to reactivate script ignored. Script is permanently locked.")
            return
        end

        ScriptActive = true
        Background.Visible = false
        print("Script status: ON")
        return
    end

    -- STATE = FALSE (disable)
    ScriptActive = false
    Locked = true

    print("Script status: OFF (locked). Menampilkan error.")

    MessageLabel.Text = ErrorMessage
    Footer.Text = ("Anda akan dikeluarkan dalam %d detik..."):format(KickDelaySeconds)
    Background.Visible = true

    warn("Controller: Script disabled. Kick countdown started.")
    KickCountdown()
end


-- ============= INISIALISASI STATUS AWAL =============
if not StartActive then
    SetActive(false)
end


-- ============= API CONTROLLER =============
local Controller = {
    IsActive = IsActive,
    SetActive = SetActive,
    Locked = function() return Locked end
}

return Controller
